machine:
  environment:
    PEBBLE_SDK: skippa/docker-pebble-sdk
  services:
    - docker
    
dependencies:
  pre:
    - docker pull $PEBBLE_SDK
    
test:
  post:
    - cd app && docker run --rm -it -v $PWD:/pebble $PEBBLE_SDK pebble build
    - VER=$(perl -ne 'while(/version": "(.*)"/g){print "$1";}' app/package.json) cp app/build/pebble.pbw $CIRCLE_ARTIFACTS/pebble-$VER.pbw
